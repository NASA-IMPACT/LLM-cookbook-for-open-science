contexts = [
    'Harmonized Landsat Sentinel-2 (HLS) Product User Guide Product Version 2.0 J.G. Masek, J. Ju, M. Claverie, S. Skakun, J.-C. Roger, E. Vermote, B. Franch, Z. Yin, J. L. Dungan Principal Investigator: Dr. Jeffrey G. Masek, NASA/GSFC Correspondence email address: Jeffrey.G.Masek@nasa.gov 1 Acronyms AROP BRDF BT CMG ETM+ GDAL GLS HDF HLS KML MGRS MSI NBAR OLI QA RSR SDS SR SZA TM TOA UTM WRS Automated Registration and Orthorectification Package Bidirectional Reflectance Distribution Function Brightness temperature Climate Modelling Grid Enhanced Thematic Mapper Plus Geospatial Data Abstraction Library Global Land Survey Hierarchical Data Format Harmonized Landsat and Sentinel-2 Keyhole Markup Language Military Grid Reference System Multi-Spectral Instrument Nadir BRDF-normalized Reflectance Operational Land Imager Quality assessment Relative spectral response Scientific Data Sets Surface reflectance Sun zenith angle Thematic Mapper Top of atmosphere Universal Transverse Mercator Worldwide Reference System 2 1 Introduction The Harmonized Landsat and Sentinel-2 (HLS) project is a NASA initiative and collaboration with USGS to produce compatible surface reflectance (SR) data from a virtual constellation of satellite sensors, the Operational Land Imager (OLI) and Multi-Spectral Instrument (MSI) onboard the Landsat-8 and Sentinel-2 remote sensing satellites respectively. The combined measurement enables global land observation every 2-3 days at moderate (30 m) spatial resolution. The HLS project uses a set of algorithms to derive seamless products from OLI and MSI: atmospheric correction, cloud and cloud-shadow masking, spatial co-registration and common gridding, view angle normalization and spectral bandpass adjustment. The HLS data products can be regarded as the building blocks for a "data cube" so that a user may examine any pixel through time and treat the near-daily reflectance time series as though it came from a single sensor. The HLS suite contains two products, S30 and L30, derived from Sentinel-2 L1C and Landsat L1TP (Collection 2) input, respectively. They are gridded into the same MGRS tiles with a 30m pixel size. 2 New in v2.0 HLS v2.0 builds on v1.4 by updating and improving processing algorithms, expanding spatial coverage, and providing validation. Particular updates are as follows: - Global coverage. All global land, including major islands but excluding Antarctica, is covered. - Input data. Landsat 8 Collection-2 (C2) data from USGS are used as input; better geolocation is expected as C2 data use the Sentinel-2 Global Reference Image (GRI) as an absolute reference. - Atmospheric correction. A USGS C version of LaSRCv3.5.5 is applied for both Landsat 8 and Sentinel-2 data for computational speedup. LaSRCv3.5.5 has been validated for both Landsat 8 and Sentinel-2 within the CEOS ACIX-I (Atmospheric Correction Inter-Comparison eXercise, http://calvalportal.ceos.org/projects/acix). - QA band. The QA band is generated exclusively by and named after Fmask, consistently for the two HLS products (S30 and L30). Like in v1.4 aerosol thickness level from atmospheric correction is also incorporated into the QA band. - BRDF adjustment. BRDF adjustment mainly normalizes the view angle effect, with the sun zenith angle largely intact. This adjustment is applied to the Sentinel-2 red-edge bands as well. - Sun and view angle bands are provided. - Product format. The product is delivered in individual Cloud Optimized GeoTIFF (COG) files to allow for spectral and spatial subsetting in applications. - Temporal Coverage and Latency. Version v2.0 moves toward "keep up" processing. The intent is to continually update products with <2-day latency. Users are cautioned however that HLS is still a research product. 3 Products overview 3.1 Input data The Operational Land Imager (OLI) sensor is a moderate spatial resolution multi-spectral imager onboard the Landsat-8 satellite, in a sun-synchronous orbit with a 705 km altitude and a 16-day 3 repeat cycle. The sensor acquires data with a 15-degree field of view resulting in approximately a 185 km image swath. The OLI sensor has 9 solar reflective bands and the data are co-registered with the data from the 2-band TIRS (Thermal Infrared Sensor) instrument onboard the same Landsat-8 satellite (Irons et al., 2012). The native spatial resolution is 30 m for OLI and 100 m for TIRS, but TIRS data are resampled to 30 m for distribution. HLS v2.0 uses Landsat-8 Collection-21 Level-1 top-of-atmosphere (TOA) product as input: for "keep-up" processing, the Real-Time data with geolocation RMSE <= 12 m (i.e. Tier-1 equivalent) are used and, for back processing, Tier-1 data are used. The Real-Time TOA OLI data have the same quality as the tier-based data do, but the Real-Time TIRS data may have lesser geolocation and radiometric quality. The Sentinel-2 Multi-Spectral Instrument (MSI) is onboard the Sentinel-2A and -2B satellites in a sun-synchronous orbit with a 786 km altitude and a combin', 
    'create a mixture situation. The "presence" rule is used: a QA bit value 1 in any of the 4 input pixels causes the output bit to be set to 1 for an L30 pixel and an output L30 QA bit is set to 0 only if all the 2x2 input pixels have 0 at that bit. 12 - S30: 10 m QA are resampled to 30 m using the same "presence" rule. A QA bit value 1 in any of the nine nesting input 10 m pixels causes the output bit to be set to 1 for S30. That is, a QA bit for S30 is set to 0 only if the input QA bit values for all the nine nesting 10 m pixels are 0. If a resampling window contains a mixture of QA bits, the "presence" rule will make the output QA bits not mutually exclusive. For example, the output QA bits may indicate a pixel is cloud, cloud shadow and water at the same time. This is not a mistake; the mixture nature of HLS QA bits allows the users to select/discard data in a way they want. The aerosol optical thickness level resample is special because it has two bits (bits 6-7 in QA). It is resampled in such a way that a higher aerosol thickness level dominates a lower aerosol level in output. For example, if any of the input pixels in the sampling window has "high aerosol," the output aerosol level will be "high aerosol," and if the highest aerosol level in the sampling window is "moderate aerosol," the output will be "moderate aerosol," and so on. 5 Spatial coverage HLS v2.0 covers all the global land except Antarctica, as depicted in a land mask (Fig. 5) derived from the NOAA shoreline dataset (https://www.ngdc.noaa.gov/mgg/shorelines/data/gshhg/latest/). Antarctica is excluded because of low solar elevations which compromise the plane-parallel atmospheric correction. Note that the data acquisition over some small oceanic islands by the Landsat and Sentinel-2 sensor may not be made regularly. Figure 5: HLS v2.0 covers the global land, including major islands but excluding Antarctica. 6 Product formats 6.1 File format HLS 2.0 products are in Cloud Optimized GeoTIFF (COG), one file per data layer to offer the flexibility of only downloading the needed data layers and, for cloud-based applications, the needed spatial subsets within a tile. The COG files are internally compressed. 13 L30 data are stored in directories such as HLS.L30.T17SLU.2020209T155956.v2.0/, which suggests L30 over tile 17SLU from data acquired on day 209 of 2020 specifically at UTC 155956. This example product consists of the following files: HLS.L30.T17SLU.2020209T155956.v2.0.B01.tif HLS.L30.T17SLU.2020209T155956.v2.0.B02.tif HLS.L30.T17SLU.2020209T155956.v2.0.B03.tif HLS.L30.T17SLU.2020209T155956.v2.0.B04.tif HLS.L30.T17SLU.2020209T155956.v2.0.B05.tif HLS.L30.T17SLU.2020209T155956.v2.0.B06.tif HLS.L30.T17SLU.2020209T155956.v2.0.B07.tif HLS.L30.T17SLU.2020209T155956.v2.0.B09.tif HLS.L30.T17SLU.2020209T155956.v2.0.B10.tif HLS.L30.T17SLU.2020209T155956.v2.0.B11.tif HLS.L30.T17SLU.2020209T155956.v2.0.Fmask.tif HLS.L30.T17SLU.2020209T155956.v2.0.SZA.tif HLS.L30.T17SLU.2020209T155956.v2.0.SAA.tif HLS.L30.T17SLU.2020209T155956.v2.0.VZA.tif HLS.L30.T17SLU.2020209T155956.v2.0.VAA.tif HLS.L30.T17SLU.2020209T155956.v2.0.cmr.xml HLS.L30.T17SLU.2020209T155956.v2.0.json HLS.L30.T17SLU.2020209T155956.v2.0.jpg The filenames for individual spectral bands and Fmask cloud mask are self-explaining. Sun zenith angle (SZA), sun azimuth angle (SAA), view zenith angle (VZA) and view azimuth angle (VAA) file are also provided; see Section 6.4 for details. File HLS.L30.T17SLU.2020209T155956.v2.0.cmr.xml is the metadata file, HLS.L30.T17SLU.2020209T155956.v2.0.json contains the size and checksum value of each file, and HLS.L30.T17SLU.2020209T155956.v2.0.jpgis a natural-color browse image. The UTC time in the filenames is the sensing time at the input Landsat-8 scene center. After gridding into the MGRS tiles it does not accurately indicate the sensing time over the tile. If two scenes overlap a MGRS tile, the sensing time of one the scenes are chosen by chance. So, this timing information is not accurate for the MGRS tile center; it is intended mainly as an identifier, not for quantitative analysis. S30 data are stored in the same format. An example directory HLS.S30.T17SLU.2020117T160901.v2.0 may contain the following files: HLS.S30.T17SLU.2020117T160901.v2.0.B01.tif HLS.S30.T17SLU.2020117T160901.v2.0.B02.tif HLS.S30.T17SLU.2020117T160901.v2.0.B03.tif HLS.S30.T17SLU.2020117T160901.v2.0.B04.tif HLS.S30.T17SLU.2020117T160901.v2.0.B05.tif HLS.S30.T17SLU.2020117T160901.v2.0.B06.tif HLS.S30.T17SLU.2020117T160901.v2.0.B07.tif HLS.S30.T17SLU.2020117T160901.v2.0.B08.tif HLS.S30.T17SLU.2020117T160901.v2.0.B8A.tif HLS.S30.T17SLU.2020117T160901.v2.0.B09.tif HLS.S30.T17SLU.2020117T160901.v2.0.B10.tif 14 HLS.S30.T17SLU.2020117T160901.v2.0.B11.tif HLS.S30.T17SLU.2020117T160901.v2.0.B12.tif HLS.S30.T17SLU.2020117T160901.v2.0.Fmask.tif HLS.S30.T17SLU.2020117T160901.v2.0.SZA.tif HLS.S30.T17SLU.2020117T160901.v2.0.SAA.tif HLS.S30.T17SLU.2020117T160901.v2.0.VZA.tif HLS.S30.T17SLU.2020117T16',
'SLU.2020117T160901.v2.0.SAA.tif HLS.S30.T17SLU.2020117T160901.v2.0.VZA.tif HLS.S30.T17SLU.2020117T160901.v2.0.VAA.tif HLS.S30.T17SLU.2020117T160901.v2.0.cmr.xml HLS.S30.T17SLU.2020117T160901.v2.0.json HLS.S30.T17SLU.2020117T160901.v2.0.jpg The UTC time in the S30 product filenames is the time the sensor begins to sense the sun-lit side of the earth for each orbit, not the exact sensing time over the tile center. When a sequence of observations is available on the same day at the high latitude, they can still be differentiated by this timing information. 6.2 L30 The product L30 contains Landsat-8 OLI surface reflectance and TOA TIRS brightness temperature gridded at 30 m spatial resolution in MGRS tiles. Table 6 lists all the data layers of the L30 product. Table 6: All the data layers of the L30 product (SR = Surface Reflectance, NBAR = Nadir BRDF- normalized Reflectance, TOA Refl. = Top of Atmosphere Reflectance, TOA BT = Top of Atmosphere Brightness temperature). Units Data type Scale Fill value Spatial Resolution Description reflectance reflectance reflectance reflectance reflectance reflectance reflectance reflectance degree degC degree degC int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 int16 0.01 0.01 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 - none uint8 - 255 30 30 30 30 30 30 30 30 30 30 30 NBAR TOA Refl. TOA BT Quality bits OLI band number 1 2 3 4 5 6 7 9 10 11 Data layer B01 B02 B03 B04 B05 B06 B07 B09 B10 B11 FMASK (Table 9) S30 The product S30 contains MSI surface reflectance at 30 m spatial resolution. Table 7 lists all the data layers of the S30 product. 15 Table 7: list of the SDS of the S30 product (SR = Surface Reflectance, NBAR = Nadir BRDF-Adjusted Reflectance, TOA Refl. = Top of Atmosphere Reflectance). Units Data type Scale Fill value Spatial Resolution Description MSI band number 1 2 3 4 5 6 7 8 8A 9 10 11 12 Data layer B01 B02 B03 B04 B05 B06 B07 B08 B8A B09 B10 B11 B12 FMASK (Table 9) reflectance reflectance reflectance reflectance reflectance reflectance reflectance reflectance reflectance reflectance reflectance reflectance reflectance int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 int16 0.0001 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 -9999 - none uint8 - 255 30 30 30 30 30 30 30 30 30 30 30 30 30 30 NBAR TOA Refl. NBAR Quality bits 6.3 The sun and view angles HLS v2.0 also provides the sun zenith/azimuth and view zenith/azimuth angles used in BRDF correction; in case a user may want to do BRDF correction differently. The S30 angle data is interpolated from the ESA-provided 5 km angles in a text form; HLS selects the view angle of the 2nd red-edge band and uses it on all bands. The L30 angle data is provided in the Collection-2 data; it is originally derived for the red band and is representative of all bands. Table 8: Description of the sun and view angles. Angle band Units Data type Scaling factor Fill value Spatial resolution Sun zenith degrees uint16 Sun azimuth degrees uint16 View zenith degrees uint16 View azimuth degrees uint16 0.01 0.01 0.01 0.01 40,000 40,000 40,000 40,000 30 m 30 m 30 m 30 m 16 6.4 Quality Assessment layer HLS v2.0 products have one Quality Assessment (QA) layer, generated from Fmask 4.2, and named after Fmask. The Fmask integer output is converted to the bit representation (Table 9) as in HLS v1.4. The HLS processing dilates the Fmask cloud and cloud shadow by 5 pixels for L30 and S30 and labels the dilation as "Adjacent to cloud/shadow." The qualitative aerosol optical thickness level from atmospheric correction is also incorporated. Table 9: Description of the bits in the one-byte Quality Assessment layer. Bits are listed from the MSB (bit 7) to the LSB (bit 0) Bit number Mask name Bit value 6-7 aerosol level 11 10 01 00 5 4 3 2 1 0 Water Snow/ice Cloud shadow Adjacent to cloud/shadow Cloud Cirrus 1 0 1 0 1 0 1 0 1 0 Reserved, but not used Mask description High aerosol Moderate aerosol Low aerosol Climatology aerosol Yes No Yes No Yes No Yes No Yes No NA See Appendix A on how to decode the QA bits with simple integer arithmetic. 17 6.5 Metadata Metadata about the L30 and S30 products is presented in the xmr.xml file. 6.5.1 Key metadata elements for L30 from the complete XML list include: * LANDSAT_PRODUCT_ID The Landsat-8 input L1 scene product ID for processing backtracing. If two adjacent scenes from the same WRS path overlap the same MGRS tile, both product IDs are reported. * SENSING_TIME The WRS scene center sensing time, carried over from the Level-1 metadata; not precisely represented the data gridded into the tile. When two scenes overlap the tile, the sensing time for each is retained. * SPATIAL_COVERAGE The percentage of the tile with data * CLOUD_COVERAGE The percentage of cloud and cloud shadow in observation based on Fmas']